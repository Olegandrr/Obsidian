# Что такое цикл событий (event loop)

Цикл событий - это однопоточный цикл, который контролирует стек вызовов и проверяет, есть ли какая-либо работа, которую необходимо выполнить в очереди задач. Если стек вызовов пуст и в очереди задач есть callback-функции, то функция удаляется из очереди и помещается с стек вызовов для выполнения.

1.    Выбрать и исполнить старейшую задачу из очереди _макрозадач_ (например, «script»).

2.    Исполнить все _микрозадачи_:

o    Пока очередь микрозадач не пуста: - Выбрать из очереди и исполнить старейшую микрозадачу

3.    Отрисовать изменения страницы, если они есть.

4.    Если очередь макрозадач пуста – подождать, пока появится макрозадача.

5.    Перейти к шагу 1.

Чтобы добавить в очередь новую _макрозадачу_:

·         Используйте setTimeout(f) с нулевой задержкой.

Этот способ можно использовать для разбиения больших вычислительных задач на части, чтобы браузер мог реагировать на пользовательские события и показывать прогресс выполнения этих частей.

Также это используется в обработчиках событий для отложенного выполнения действия после того, как событие полностью обработано (всплытие завершено).

Для добавления в очередь новой _микрозадачи_:

·         Используйте queueMicrotask(f).

·         Также обработчики промисов выполняются в рамках очереди микрозадач.

События пользовательского интерфейса и сетевые события в промежутках между микрозадачами не обрабатываются: микрозадачи исполняются непрерывно одна за другой.

Поэтому queueMicrotask можно использовать для асинхронного выполнения функции в том же состоянии окружения.
